<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Medical Reports</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div class="d-flex" id="wrapper">
        <%- include('../partials/sidebar') %>
            <div id="page-content-wrapper" class="main-gradient-bg">
                <nav class="navbar navbar-expand-lg navbar-light bg-transparent py-4 px-4">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-align-left primary-text fs-4 me-3" id="menu-toggle"></i>
                        <h2 class="fs-2 m-0 text-dark fw-bold">Medical Reports</h2>
                    </div>
                </nav>
                <div class="container-fluid px-4 mb-5">

                    <!-- Upload Section -->
                    <div class="row mb-5">
                        <div class="col-12">
                            <div class="dash-card p-4 shadow-sm bg-white rounded-4 border-0">
                                <h5 class="fw-bold text-primary mb-3"><i class="fas fa-cloud-upload-alt me-2"></i>Upload
                                    New Report</h5>
                                <form action="/reports/upload" method="POST" enctype="multipart/form-data"
                                    class="row g-3 align-items-end">
                                    <div class="col-md-4">
                                        <label class="form-label small text-muted fw-bold">Report Title</label>
                                        <input type="text" class="form-control" name="title"
                                            placeholder="e.g. Blood Test - Jan 2025" required>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label small text-muted fw-bold">Type</label>
                                        <select class="form-select" name="type">
                                            <option value="blood_test">Blood Test</option>
                                            <option value="xray">X-Ray</option>
                                            <option value="mri">MRI</option>
                                            <option value="prescription">Prescription</option>
                                            <option value="other" selected>Other</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small text-muted fw-bold">File (JPG, PNG)</label>
                                        <input type="file" class="form-control" name="reportFile"
                                            accept=".jpg,.jpeg,.png,.gif" required>
                                    </div>
                                    <div class="col-md-1">
                                        <button type="submit" class="btn btn-primary w-100 rounded-pill"><i
                                                class="fas fa-plus"></i></button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Grid -->
                    <div class="row g-4">
                        <% if(reports && reports.length> 0) { %>
                            <% reports.forEach(function(report) { %>
                                <div class="col-md-6 col-lg-4 col-xl-3">
                                    <div class="card h-100 border-0 shadow-sm rounded-4 position-relative report-card">
                                        <!-- Preview Section -->
                                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center overflow-hidden"
                                            style="height: 180px;">
                                            <% if(report.mimeType && report.mimeType.startsWith('image/')) { %>
                                                <img src="<%= report.fileUrl %>" class="w-100 h-100"
                                                    style="object-fit: cover; transition: transform 0.3s;">
                                                <% } else if (report.mimeType==='application/pdf' ) { %>
                                                    <i class="fas fa-file-pdf text-danger display-1"></i>
                                                    <% } else { %>
                                                        <i class="fas fa-file-alt text-secondary display-1"></i>
                                                        <% } %>
                                        </div>

                                        <div class="card-body p-3">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <div>
                                                    <h6 class="fw-bold text-dark mb-0 text-truncate"
                                                        style="max-width: 15rem;">
                                                        <%= report.title %>
                                                    </h6>
                                                    <small class="text-muted text-uppercase" style="font-size: 0.7rem;">
                                                        <%= report.fileType.replace('_', ' ' ) %>
                                                    </small>
                                                </div>
                                                <!-- Action Dropdown? Or just delete/download -->
                                            </div>
                                            <p class="text-muted small mb-3"><i class="far fa-calendar-alt me-1"></i>
                                                <%= new Date(report.uploadedAt).toLocaleDateString() %>
                                            </p>

                                            <div class="d-flex gap-2">
                                                <a href="<%= report.fileUrl %>" target="_blank"
                                                    class="btn btn-sm btn-outline-primary flex-grow-1 rounded-pill"><i
                                                        class="fas fa-eye me-1"></i>View</a>
                                                <!-- Simple Delete Form -->
                                                <form action="/reports/delete/<%= report._id %>" method="POST"
                                                    onsubmit="return confirm('Delete this report?');">
                                                    <button type="submit"
                                                        class="btn btn-sm btn-outline-danger rounded-circle"><i
                                                            class="fas fa-trash-alt"></i></button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% }) %>
                                    <% } else { %>
                                        <div class="col-12">
                                            <div class="dash-card p-5 text-center text-muted">
                                                <i class="fas fa-folder-open display-4 mb-3 opacity-25"></i>
                                                <p class="mb-0">No reports uploaded yet.</p>
                                                <small>Upload your medical documents to keep them organized.</small>
                                            </div>
                                        </div>
                                        <% } %>
                    </div>
                </div>
            </div>
    </div>
    <%- include('../partials/footer') %>

        <script>
            var el = document.getElementById("wrapper");
            var toggleButton = document.getElementById("menu-toggle");
            if (toggleButton) {
                toggleButton.onclick = function () {
                    el.classList.toggle("toggled");
                };
            }
        </script>
</body>

</html>